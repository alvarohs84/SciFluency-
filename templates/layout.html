<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>{{ app_name }}</title>
<style>
/* --- CORES DO RESEARCH OS --- */
:root { 
    --bg: #f4f6f8; --card: #ffffff; --text: #2c3e50; --subtext: #7f8c8d; 
    --accent: #2980b9; --border: #dfe6e9; --input: #fdfdfd;
    --status-todo: #95a5a6; --status-doing: #f39c12; --status-done: #27ae60;
}
body.dark-mode { 
    --bg: #1e1e1e; --card: #2d2d2d; --text: #ecf0f1; --subtext: #bdc3c7; 
    --accent: #3498db; --border: #444; --input: #3d3d3d;
}
body{font-family:'Segoe UI',sans-serif;background:var(--bg);margin:0;padding-bottom:100px;color:var(--text); transition:0.3s;}

/* --- LAYOUT GERAL --- */
.header{background:var(--card);padding:15px;border-bottom:1px solid var(--border);display:flex;align-items:center;position:sticky;top:0;z-index:1000; box-shadow: 0 2px 5px rgba(0,0,0,0.05);}
.container{padding:20px;max-width:800px;margin:0 auto;}
.sidebar{height:100%;width:0;position:fixed;top:0;left:0;background:var(--card);overflow-x:hidden;transition:0.3s;padding-top:60px;z-index:2000;box-shadow:2px 0 100px rgba(0,0,0,0.2); border-right:1px solid var(--border);}
.sidebar a{padding:15px 25px;text-decoration:none;font-size:1.1rem;color:var(--text);display:block;border-bottom:1px solid var(--border);}
.sidebar a span{display:block;font-size:0.8rem;color:var(--subtext);margin-top:2px;}

/* --- COMPONENTES --- */
.card{background:var(--card);padding:20px;margin-bottom:15px;border-radius:12px;border:1px solid var(--border);box-shadow:0 2px 8px rgba(0,0,0,0.03);}
.btn{background:var(--accent);color:#fff;border:none;padding:10px 20px;border-radius:6px;font-weight:600;cursor:pointer; display:inline-block; text-align:center; text-decoration:none;}
.btn-sm{padding:5px 10px; font-size:0.8rem;}
.fab { position: fixed; bottom: 30px; right: 20px; width: 60px; height: 60px; background: var(--accent); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); cursor: pointer; z-index: 1400; }

/* --- LIBRARY SPECIFIC --- */
.ref-card { display: flex; flex-direction: column; gap: 10px; border-left: 5px solid var(--status-todo); }
.ref-card.reading { border-left-color: var(--status-doing); }
.ref-card.done { border-left-color: var(--status-done); }
.ref-meta { display: flex; justify-content: space-between; align-items: center; color: var(--subtext); font-size: 0.9rem; }
.ref-actions { display: flex; gap: 5px; margin-top: 10px; border-top: 1px solid var(--border); padding-top: 10px;}
.status-badge { padding: 3px 8px; border-radius: 10px; font-size: 0.75rem; color: white; background: var(--status-todo); }

/* --- DASHBOARD --- */
.dash-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
.stat-box { background: var(--card); padding: 15px; border-radius: 10px; text-align: center; border: 1px solid var(--border); }
.stat-num { font-size: 2rem; font-weight: bold; color: var(--accent); }
.stat-label { font-size: 0.9rem; color: var(--subtext); }

/* --- INPUTS --- */
input, textarea, select { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid var(--border); border-radius: 8px; background: var(--input); color: var(--text); box-sizing: border-box;}
.modal { display: none; position: fixed; z-index: 3000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); align-items: center; justify-content: center; }
.modal-content { background-color: var(--card); padding: 25px; border-radius: 12px; width: 90%; max-width: 500px; }

/* --- SCI-WRITER --- */
.writer-toolbar { display: flex; overflow-x: auto; gap: 10px; padding-bottom: 10px; }
.writer-tag { white-space: nowrap; background: var(--bg); border: 1px solid var(--border); padding: 5px 15px; border-radius: 20px; cursor: pointer; }
.text-area-box { width: 100%; padding: 15px; border-radius: 12px; font-family: inherit; line-height: 1.6; min-height: 300px; border: 1px solid var(--border); background: var(--input); color: var(--text);}
</style>
<script>
function openNav(){document.getElementById("side").style.width="280px";}
function closeNav(){document.getElementById("side").style.width="0";}
function toggleTheme() { document.body.classList.toggle('dark-mode'); }
function toggleModal(id) { 
    const m = document.getElementById(id); 
    m.style.display = (m.style.display === 'flex') ? 'none' : 'flex'; 
}
</script>
</head>
<body>

<div id="side" class="sidebar">
    <a href="javascript:void(0)" onclick="closeNav()" style="text-align:right;font-size:2rem;padding-right:20px;">&times;</a>
    <a href="/">üìä Dashboard <span>Vis√£o Geral</span></a>
    <a href="/library">üìö My Library <span>Gerenciar Refer√™ncias</span></a>
    <a href="/writer">üìù Sci-Writer <span>Escrever Artigo</span></a>
    <a href="/vocab_list">üóÇÔ∏è Vocab Deck <span>Flashcards</span></a>
    <a href="/search">üîç PubMed <span>Buscar Novos</span></a>
</div>

<div class="header">
    <span onclick="openNav()" style="font-size:1.5rem;cursor:pointer;">‚ò∞</span>
    <h3 style="margin-left:20px; flex:1;">{{ app_name }}</h3>
    <span onclick="toggleTheme()" style="font-size:1.5rem;cursor:pointer;">üåô</span>
</div>

{% if mode == 'dashboard' %}
<div class="container">
    <h2>{{ project.title }}</h2>
    <p style="color:var(--subtext);">Alvo: {{ project.target_journal }}</p>
    
    <div class="dash-grid">
        <div class="stat-box"><div class="stat-num">{{ stats.refs }}</div><div class="stat-label">Total References</div></div>
        <div class="stat-box"><div class="stat-num" style="color:#f39c12;">{{ stats.reading }}</div><div class="stat-label">Reading Now</div></div>
        <div class="stat-box"><div class="stat-num" style="color:#27ae60;">{{ stats.done }}</div><div class="stat-label">Completed</div></div>
        <div class="stat-box"><div class="stat-num">{{ stats.vocab }}</div><div class="stat-label">Vocab Cards</div></div>
    </div>

    <h3>A√ß√µes R√°pidas</h3>
    <div style="display:grid; gap:10px;">
        <a href="/library" class="btn" style="background:#34495e;">üìÇ Abrir Biblioteca</a>
        <a href="/writer" class="btn">‚úçÔ∏è Continuar Escrevendo</a>
    </div>
</div>

{% elif mode == 'library' %}
<div class="container">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h3>Minha Biblioteca</h3>
        <button class="btn" onclick="toggleModal('addRefModal')">+ PDF</button>
    </div>

    {% for ref in references %}
    <div class="card ref-card {{ ref.status }}">
        <div class="ref-meta">
            <span style="font-weight:bold; color:var(--accent);">{{ ref.year }}</span>
            <span class="status-badge" style="background:var(--status-{{ ref.status|replace('_','') }});">
                {{ ref.status|upper }}
            </span>
        </div>
        <h4 style="margin:5px 0;">{{ ref.title }}</h4>
        <small style="color:var(--subtext);">{{ ref.authors }}</small>
        
        <div class="ref-actions">
            <a href="/update_status/{{ref.id}}/reading" class="btn btn-sm" style="background:var(--bg); color:var(--text);">üìñ Ler</a>
            <a href="/update_status/{{ref.id}}/done" class="btn btn-sm" style="background:var(--bg); color:var(--text);">‚úÖ Feito</a>
            <a href="/delete_ref/{{ref.id}}" class="btn btn-sm" style="background:#e74c3c; color:white;">üóëÔ∏è</a>
        </div>
    </div>
    {% else %}
    <div style="text-align:center; color:var(--subtext); padding:40px;">
        <p>Nenhum artigo ainda.</p>
        <p>Clique em <b>+ PDF</b> para come√ßar.</p>
    </div>
    {% endfor %}
</div>

<div id="addRefModal" class="modal">
    <div class="modal-content">
        <h3>Adicionar Refer√™ncia</h3>
        <form action="/library" method="POST" enctype="multipart/form-data">
            <label>Arquivo PDF (Obrigat√≥rio)</label>
            <input type="file" name="pdf_file" required accept=".pdf">
            <div style="display:grid; grid-template-columns: 2fr 1fr; gap:10px;">
                <input type="text" name="authors" placeholder="Autores (ex: Silva et al.)">
                <input type="text" name="year" placeholder="Ano">
            </div>
            <input type="text" name="title" placeholder="T√≠tulo (opcional, tenta autom√°tico)">
            <button class="btn" style="width:100%;">SALVAR NA BIBLIOTECA</button>
        </form>
        <button class="btn" style="background:#888; width:100%; margin-top:10px;" onclick="toggleModal('addRefModal')">CANCELAR</button>
    </div>
</div>

{% elif mode == 'writer' %}
<div class="container">
    <h3>Sci-Writer</h3>
    <div class="writer-toolbar">
        {% for cat, items in connectors.items() %}
        <span class="writer-tag">{{ cat }}</span>
        {% endfor %}
    </div>
    <textarea class="text-area-box" placeholder="Escreva seu artigo aqui..."></textarea>
</div>

{% elif mode == 'search' %}
<div class="container">
    <h3>PubMed Search</h3>
    <form action="/search" method="POST">
        <input type="text" name="query" placeholder="Termos de busca...">
        <button class="btn" style="width:100%;">BUSCAR ARTIGOS</button>
    </form>
    
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:20px;">
        {% for link in links %}
        <div class="card hub-card" onclick="window.open('{{link.url}}', '_blank')">
            <div style="font-size:2rem;">{{link.icon}}</div>
            <b>{{link.name}}</b>
        </div>
        {% endfor %}
    </div>
</div>

{% endif %}

</body>
</html>
